
<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Abaco Divisore - By piccionenberg</title>
  <link rel="icon" type="image/png" href="../logo.png">
  <link rel="shortcut icon" type="image/png" href="../logo.png">
  <link rel="apple-touch-icon" href="../logo.png">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    /* Regola globale per prevenire overflow */
    * {
      max-width: 100%;
      box-sizing: border-box;
    }
    
    /* Regola specifica per prevenire overflow orizzontale */
    html, body {
      overflow-x: hidden;
      max-width: 100vw;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      min-height: 100vh;
      padding: 20px;
      color: #ffffff;
      overflow-x: hidden; /* Previene overflow orizzontale globale */
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: rgba(20, 25, 45, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
      overflow: hidden;
      animation: slideIn 0.6s ease-out;
      border: 1px solid rgba(255, 255, 255, 0.1);
      width: 100%;
      box-sizing: border-box; /* Include padding e border nella larghezza */
      position: relative; /* Contesto per elementi assoluti */
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    header {
      background: linear-gradient(135deg, #2d3748, #4a5568);
      color: white;
      padding: 30px;
      text-align: center;
      position: relative;
      overflow: hidden;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      max-width: 100%;
      box-sizing: border-box;
      width: 100%;
    }

    header::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255, 255, 255, 0.05) 0%, transparent 70%);
      animation: pulse 4s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); opacity: 0.3; }
      50% { transform: scale(1.1); opacity: 0.6; }
    }

    h1 {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 10px;
      position: relative;
      z-index: 1;
      overflow: hidden;
      max-width: 100%;
      box-sizing: border-box;
      word-wrap: break-word;
    }

    .subtitle {
      font-size: 1.1rem;
      opacity: 0.8;
      position: relative;
      z-index: 1;
      overflow: hidden;
      max-width: 100%;
      box-sizing: border-box;
      word-wrap: break-word;
    }

    main {
      padding: 40px;
      overflow: hidden;
      max-width: 100%;
      box-sizing: border-box;
      width: 100%;
      position: relative;
    }

    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
      margin-bottom: 30px;
      overflow: hidden;
      max-width: 100%;
      box-sizing: border-box;
      width: 100%;
      position: relative;
    }

    /* Media Queries per Responsivit√† Mobile */
    @media (max-width: 1200px) {
      .container {
        margin: 10px;
        border-radius: 15px;
      }
      
      main {
        padding: 30px 20px;
      }
      
      .grid {
        gap: 25px;
      }
    }

    @media (max-width: 1024px) {
      .grid {
        grid-template-columns: 1fr;
        gap: 20px;
      }
      
      .product {
        grid-template-columns: 1fr 100px 70px;
        gap: 10px;
        min-width: 0;
        overflow-x: hidden;
      }
    }

    @media (max-width: 768px) {
      body {
        padding: 10px;
        overflow-x: hidden; /* Previene overflow orizzontale */
      }
      
      .container {
        margin: 0;
        border-radius: 10px;
        max-width: 100%;
        overflow-x: hidden; /* Previene overflow del container */
      }
      
      header {
        padding: 25px 20px;
        overflow-x: hidden; /* Previene overflow dell'header */
      }
      
      h1 {
        font-size: 2rem;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-wrap: wrap;
        gap: 10px;
        word-wrap: break-word; /* Permette il wrap del testo */
        overflow-wrap: break-word;
      }
      
      .logo {
        width: 40px;
        height: 40px;
        margin-right: 10px;
        flex-shrink: 0; /* Previene la compressione del logo */
        max-width: 100%;
        box-sizing: border-box;
        overflow: hidden;
      }
      
      .subtitle {
        font-size: 1rem;
        word-wrap: break-word;
        overflow-wrap: break-word;
      }
      
      main {
        padding: 20px 15px;
        overflow-x: hidden; /* Previene overflow del main */
      }
      
      .card {
        padding: 20px;
        border-radius: 12px;
        overflow-x: hidden; /* Previene overflow delle card */
        word-wrap: break-word;
      }
      
      .card h2 {
        font-size: 1.3rem;
        margin-bottom: 20px;
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
        word-wrap: break-word;
        overflow-wrap: break-word;
      }
      
      .product {
        grid-template-columns: 1fr;
        gap: 10px;
        padding: 12px;
        text-align: center;
        overflow: hidden; /* Previene overflow dei prodotti */
        word-wrap: break-word;
        min-width: 0;
        max-width: 100%;
        box-sizing: border-box;
      }
      
      .product-name {
        margin-bottom: 8px;
        word-wrap: break-word;
        overflow-wrap: break-word;
        hyphens: auto; /* Aggiunge trattini automatici */
      }
      
      .product-price {
        text-align: center;
        margin-bottom: 8px;
        word-wrap: break-word;
      }
      
      .quantity-container {
        max-width: 100px;
        gap: 3px;
      }

      .quantity-btn {
        width: 28px;
        height: 28px;
        font-size: 1rem;
      }

      .quantity-input {
        min-width: 40px;
        max-width: 50px;
        height: 28px;
        font-size: 0.8rem;
      }

      .participant-controls {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }

      .participant-label {
        min-width: auto;
        font-size: 0.9rem;
      }

      .class-select {
        width: 100%;
        min-width: auto;
        font-size: 0.85rem;
        padding: 10px;
      }

      .product input {
        width: 100%;
        max-width: 120px;
        margin: 0 auto;
        box-sizing: border-box; /* Include padding e border nella larghezza */
      }
      
      .participants-section {
        text-align: center;
        overflow-x: hidden;
      }
      
      #participants {
        width: 150px;
        font-size: 1.1rem;
        max-width: 100%;
        box-sizing: border-box;
      }
      
      .participant-result {
        padding: 15px;
        margin: 15px 0;
        overflow-x: hidden;
        word-wrap: break-word;
      }
      
      .participant-title {
        font-size: 1.1rem;
        margin-bottom: 12px;
        word-wrap: break-word;
      }
      
      .item-distribution {
        grid-template-columns: 1fr;
        gap: 8px;
        text-align: center;
        padding: 10px;
        overflow-x: hidden;
        word-wrap: break-word;
      }
      
      .contacts-section {
        padding: 20px 15px;
        margin-top: 25px;
        overflow-x: hidden;
      }
      
      .contact-item {
        display: block;
        margin: 8px 0;
        padding: 10px 12px;
        font-size: 0.9rem;
        text-align: center;
        word-wrap: break-word;
        overflow-wrap: break-word;
      }
      
      .homepage-link {
        position: relative;
        top: auto;
        right: auto;
        display: inline-block;
        margin-top: 15px;
        font-size: 0.85rem;
        padding: 10px 16px;
        word-wrap: break-word;
      }
    }

    @media (max-width: 480px) {
      body {
        padding: 5px;
        overflow-x: hidden;
      }
      
      header {
        padding: 20px 15px;
        overflow-x: hidden;
      }
      
      h1 {
        font-size: 1.7rem;
        flex-direction: column;
        text-align: center;
        word-wrap: break-word;
        overflow-wrap: break-word;
      }
      
      .logo {
        width: 35px;
        height: 35px;
        margin-right: 0;
        margin-bottom: 8px;
        flex-shrink: 0;
        max-width: 100%;
        box-sizing: border-box;
        overflow: hidden;
      }
      
      .subtitle {
        font-size: 0.95rem;
        word-wrap: break-word;
        overflow-wrap: break-word;
      }
      
      main {
        padding: 15px 10px;
        overflow-x: hidden;
      }
      
      .card {
        padding: 15px;
        border-radius: 10px;
        overflow-x: hidden;
        word-wrap: break-word;
      }
      
      .card h2 {
        font-size: 1.2rem;
        margin-bottom: 15px;
        word-wrap: break-word;
        overflow-wrap: break-word;
      }
      
      .category-title {
        font-size: 1.1rem;
        margin-bottom: 12px;
        word-wrap: break-word;
        overflow-wrap: break-word;
      }
      
      .category-section {
        margin-bottom: 20px;
        overflow: hidden;
        max-width: 100%;
        box-sizing: border-box;
      }
      
      .product {
        padding: 10px;
        margin: 8px 0;
        overflow: hidden;
        word-wrap: break-word;
        max-width: 100%;
        box-sizing: border-box;
      }
      
      .product-name {
        font-size: 0.95rem;
        word-wrap: break-word;
        overflow-wrap: break-word;
        hyphens: auto;
      }
      
      .product-price {
        font-size: 0.9rem;
        word-wrap: break-word;
      }
      
      .tier-badge {
        font-size: 0.65rem;
        padding: 2px 6px;
        word-wrap: break-word;
      }
      
      .quantity-container {
        max-width: 90px;
        gap: 2px;
      }

      .quantity-btn {
        width: 26px;
        height: 26px;
        font-size: 0.9rem;
      }

      .quantity-input {
        min-width: 35px;
        max-width: 45px;
        height: 26px;
        font-size: 0.75rem;
      }

      .participant-controls {
        padding: 8px;
        gap: 6px;
      }

      .participant-label {
        font-size: 0.85rem;
      }

      .class-select {
        font-size: 0.8rem;
        padding: 8px;
      }

      .product input {
        padding: 10px;
        font-size: 0.95rem;
        max-width: 100px;
        width: 100%;
        box-sizing: border-box;
      }
      
      #participants {
        width: 120px;
        font-size: 1rem;
        padding: 10px;
        max-width: 100%;
        box-sizing: border-box;
      }
      
      .participant-result {
        padding: 12px;
        margin: 12px 0;
        overflow-x: hidden;
        word-wrap: break-word;
      }
      
      .participant-title {
        font-size: 1rem;
        word-wrap: break-word;
      }
      
      .item-distribution {
        padding: 8px;
        font-size: 0.9rem;
        overflow-x: hidden;
        word-wrap: break-word;
      }
      
      .total-cost {
        padding: 10px;
        font-size: 0.95rem;
        word-wrap: break-word;
        overflow: hidden;
        max-width: 100%;
        box-sizing: border-box;
      }
      
      .contacts-section {
        padding: 15px 10px;
        overflow: hidden;
        max-width: 100%;
        box-sizing: border-box;
      }
      
      .contact-item {
        padding: 8px 10px;
        font-size: 0.85rem;
        word-wrap: break-word;
        overflow-wrap: break-word;
        overflow: hidden;
        max-width: 100%;
        box-sizing: border-box;
      }
      
      .homepage-link {
        font-size: 0.8rem;
        padding: 8px 12px;
        margin-top: 12px;
        word-wrap: break-word;
        overflow: hidden;
        max-width: 100%;
        box-sizing: border-box;
      }
    }

    /* Media query per schermi molto piccoli */
    @media (max-width: 360px) {
      body {
        padding: 2px;
      }
      
      .container {
        border-radius: 8px;
      }
      
      header {
        padding: 15px 10px;
      }
      
      h1 {
        font-size: 1.5rem;
      }
      
      .logo {
        width: 30px;
        height: 30px;
        max-width: 100%;
        box-sizing: border-box;
        overflow: hidden;
        flex-shrink: 0;
      }
      
      main {
        padding: 10px 5px;
      }
      
      .card {
        padding: 10px;
        border-radius: 8px;
        overflow-x: hidden;
      }
      
      .category-section {
        margin-bottom: 15px;
        overflow: hidden;
        max-width: 100%;
        box-sizing: border-box;
      }
      
      .category-title {
        font-size: 1rem;
        margin-bottom: 10px;
        word-wrap: break-word;
        overflow-wrap: break-word;
      }
      
      .product {
        padding: 8px;
        margin: 6px 0;
        gap: 5px;
        overflow: hidden;
        max-width: 100%;
        box-sizing: border-box;
      }
      
      .product-name {
        font-size: 0.9rem;
      }
      
      .product-price {
        font-size: 0.85rem;
      }
      
      .tier-badge {
        font-size: 0.6rem;
        padding: 1px 4px;
      }
      
      .quantity-container {
        max-width: 80px;
        gap: 2px;
      }

      .quantity-btn {
        width: 24px;
        height: 24px;
        font-size: 0.8rem;
      }

      .quantity-input {
        min-width: 30px;
        max-width: 40px;
        height: 24px;
        font-size: 0.7rem;
      }

      .participant-controls {
        padding: 6px;
        gap: 4px;
      }

      .participant-label {
        font-size: 0.8rem;
      }

      .class-select {
        font-size: 0.75rem;
        padding: 6px;
      }

      .product input {
        padding: 8px;
        font-size: 0.9rem;
        max-width: 80px;
      }
      
      #participants {
        width: 100px;
        font-size: 0.9rem;
        padding: 8px;
      }
      
      .participant-result {
        padding: 8px;
        margin: 8px 0;
        overflow: hidden;
        word-wrap: break-word;
        max-width: 100%;
        box-sizing: border-box;
      }
      
      .item-distribution {
        padding: 6px;
        font-size: 0.85rem;
        overflow: hidden;
        word-wrap: break-word;
        min-width: 0;
        max-width: 100%;
        box-sizing: border-box;
      }
      
      .contacts-section {
        padding: 10px 5px;
        overflow: hidden;
        max-width: 100%;
        box-sizing: border-box;
      }
      
      .contact-item {
        padding: 6px 8px;
        font-size: 0.8rem;
        overflow: hidden;
        max-width: 100%;
        box-sizing: border-box;
        word-wrap: break-word;
      }
      
      .contact-item:hover {
        transform: none;
      }
      
      .contact-item:active {
        transform: scale(0.95);
        transition: transform 0.1s ease;
      }
    }

    /* Ottimizzazioni Touch per Abaco */
    @media (hover: none) and (pointer: coarse) {
      .product {
        min-height: 80px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        overflow: hidden;
        max-width: 100%;
        box-sizing: border-box;
      }
      
      .product:hover {
        transform: none;
      }
      
      .product:active {
        transform: scale(0.98);
        transition: transform 0.1s ease;
      }
      
      .quantity-container {
        max-width: 120px;
        gap: 5px;
      }

      .quantity-btn {
        width: 44px;
        height: 44px;
        font-size: 1.2rem;
        min-height: 44px; /* Dimensione minima per touch */
      }

      .quantity-input {
        min-width: 50px;
        max-width: 60px;
        height: 44px;
        font-size: 1rem;
        min-height: 44px; /* Dimensione minima per touch */
      }

      .participant-controls {
        gap: 8px;
        padding: 12px;
      }

      .participant-label {
        font-size: 1rem;
      }

      .class-select {
        min-height: 44px; /* Dimensione minima per touch */
        font-size: 1rem; /* Previene zoom su iOS */
        padding: 12px;
      }

      .product input {
        min-height: 44px; /* Dimensione minima per touch */
        font-size: 1rem; /* Previene zoom su iOS */
        overflow: hidden;
        max-width: 100%;
        box-sizing: border-box;
      }
      
      #participants {
        min-height: 44px;
        font-size: 1rem;
        overflow: hidden;
        max-width: 100%;
        box-sizing: border-box;
      }
      
      .contact-item:hover {
        transform: none;
      }
      
      .contact-item:active {
        transform: scale(0.95);
        transition: transform 0.1s ease;
      }
      
      .contact-item {
        overflow: hidden;
        max-width: 100%;
        box-sizing: border-box;
        word-wrap: break-word;
      }
      
      .contact-item:hover {
        transform: none;
      }
      
      .contact-item:active {
        transform: scale(0.95);
        transition: transform 0.1s ease;
      }
    }

    .card {
      background: rgba(45, 55, 72, 0.6);
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.1);
      transition: all 0.3s ease;
      overflow: hidden;
      max-width: 100%;
      box-sizing: border-box;
      width: 100%; /* Forza la larghezza al 100% */
      position: relative; /* Contesto per elementi assoluti */
    }

    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
      border-color: rgba(99, 179, 237, 0.3);
    }

    .card h2 {
      color: #ffffff;
      font-size: 1.5rem;
      margin-bottom: 25px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
      overflow: hidden;
      max-width: 100%;
      box-sizing: border-box;
      word-wrap: break-word;
    }

    .card h2::before {
      content: '';
      width: 4px;
      height: 25px;
      background: linear-gradient(135deg, #63b3ed, #4299e1);
      border-radius: 2px;
    }

    .category-section {
      margin-bottom: 30px;
      overflow: hidden; /* Previene overflow delle sezioni */
      word-wrap: break-word;
      max-width: 100%; /* Limita la larghezza massima */
      box-sizing: border-box; /* Include padding e border nella larghezza */
      width: 100%; /* Forza la larghezza al 100% */
      position: relative; /* Contesto per elementi assoluti */
    }

    .category-title {
      font-size: 1.2rem;
      font-weight: 600;
      color: #63b3ed;
      margin-bottom: 15px;
      padding: 10px 0;
      border-bottom: 1px solid rgba(99, 179, 237, 0.3);
      word-wrap: break-word;
      overflow-wrap: break-word;
      overflow: hidden;
      max-width: 100%;
      box-sizing: border-box;
    }

    .product {
      display: grid;
      grid-template-columns: 1fr auto auto;
      gap: 10px;
      align-items: center;
      margin: 12px 0;
      padding: 15px;
      background: rgba(99, 179, 237, 0.05);
      border-radius: 10px;
      transition: all 0.3s ease;
      border: 1px solid rgba(99, 179, 237, 0.1);
      overflow: hidden; /* Previene overflow dei prodotti */
      word-wrap: break-word;
      min-width: 0; /* Permette alla griglia di ridursi */
      max-width: 100%; /* Limita la larghezza massima */
      box-sizing: border-box; /* Include padding e border nella larghezza */
      width: 100%; /* Forza la larghezza al 100% */
    }

    .product:hover {
      background: rgba(99, 179, 237, 0.1);
      transform: translateX(5px);
      border-color: rgba(99, 179, 237, 0.3);
    }

    /* Disabilita transform su schermi piccoli per evitare overflow */
    @media (max-width: 768px) {
      .product:hover {
        transform: none;
      }
    }

    .product-name {
      font-weight: 500;
      color: #ffffff;
      word-wrap: break-word;
      overflow-wrap: break-word;
      hyphens: auto;
      min-width: 0; /* Permette al contenuto di ridursi */
      max-width: 100%; /* Limita la larghezza massima */
      overflow: hidden; /* Previene overflow del testo */
    }

    .product-price {
      font-weight: 600;
      color: #68d391;
      text-align: right;
      min-width: 0; /* Permette al contenuto di ridursi */
      max-width: 100%; /* Limita la larghezza massima */
      overflow: hidden; /* Previene overflow del prezzo */
      white-space: nowrap; /* Evita che il prezzo vada a capo */
    }

    .tier-badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 0.7rem;
      font-weight: 600;
      margin-left: 8px;
      overflow: hidden;
      max-width: 100%;
      box-sizing: border-box;
      white-space: nowrap;
    }

    .tier-novizio { background: #a0aec0; color: #2d3748; }
    .tier-avanzato { background: #ed8936; color: white; }
    .tier-esperto { background: #718096; color: white; }
    .tier-custode { background: #d69e2e; color: white; }
    .tier-maestro { background: #4299e1; color: white; }
    .tier-tutti { background: linear-gradient(135deg, #667eea, #764ba2); color: white; }

    .quantity-container {
      display: flex;
      align-items: center;
      gap: 5px;
      max-width: 120px;
      width: 100%;
    }

    .quantity-btn {
      width: 32px;
      height: 32px;
      border: 2px solid rgba(99, 179, 237, 0.3);
      border-radius: 6px;
      background: rgba(45, 55, 72, 0.8);
      color: #63b3ed;
      font-size: 1.2rem;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .quantity-btn:hover {
      background: rgba(99, 179, 237, 0.2);
      border-color: rgba(99, 179, 237, 0.5);
      transform: scale(1.05);
    }

    .quantity-btn:active {
      transform: scale(0.95);
    }

    .quantity-input {
      flex: 1;
      min-width: 50px;
      max-width: 60px;
      height: 32px;
      padding: 0 8px;
      border: 2px solid rgba(99, 179, 237, 0.3);
      border-radius: 6px;
      font-size: 0.9rem;
      text-align: center;
      transition: all 0.3s ease;
      background: rgba(45, 55, 72, 0.8);
      color: #ffffff;
      box-sizing: border-box;
      /* Rimuove le freccette (spinner) dagli input numerici */
      -moz-appearance: textfield;
    }

    .quantity-input::-webkit-outer-spin-button,
    .quantity-input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    .participant-controls {
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 10px 0;
      padding: 10px;
      background: rgba(99, 179, 237, 0.05);
      border-radius: 8px;
      border: 1px solid rgba(99, 179, 237, 0.1);
    }

    .participant-label {
      font-weight: 600;
      color: #63b3ed;
      min-width: 100px;
    }

    .class-select {
      padding: 8px 12px;
      border: 2px solid rgba(99, 179, 237, 0.3);
      border-radius: 6px;
      background: rgba(45, 55, 72, 0.8);
      color: #ffffff;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.3s ease;
      min-width: 120px;
    }

    .class-select:focus {
      outline: none;
      border-color: #63b3ed;
      box-shadow: 0 0 0 3px rgba(99, 179, 237, 0.2);
    }

    .class-select:hover {
      border-color: rgba(99, 179, 237, 0.5);
    }

    .priority-info {
      background: rgba(237, 137, 54, 0.1);
      border: 1px solid rgba(237, 137, 54, 0.3);
      border-radius: 8px;
      padding: 15px;
      margin: 20px 0;
      color: #ed8936;
      font-size: 0.9rem;
    }

    .priority-info h4 {
      color: #ed8936;
      margin-bottom: 10px;
      font-size: 1rem;
    }

    .priority-list {
      list-style: none;
      padding: 0;
    }

    .priority-list li {
      margin: 5px 0;
      padding: 5px 10px;
      background: rgba(237, 137, 54, 0.1);
      border-radius: 4px;
      border-left: 3px solid #ed8936;
    }

    .product input, #participants {
      padding: 12px;
      border: 2px solid rgba(99, 179, 237, 0.3);
      border-radius: 8px;
      font-size: 1rem;
      text-align: center;
      transition: all 0.3s ease;
      background: rgba(45, 55, 72, 0.8);
      color: #ffffff;
      box-sizing: border-box; /* Include padding e border nella larghezza */
      max-width: 100%;
      overflow: hidden;
      white-space: nowrap;
    }

    .product input:focus, #participants:focus {
      outline: none;
      border-color: #63b3ed;
      box-shadow: 0 0 0 3px rgba(99, 179, 237, 0.2);
      transform: scale(1.02);
    }

    .participants-section {
      text-align: center;
    }

    .participants-label {
      display: block;
      font-weight: 600;
      color: #ffffff;
      margin-bottom: 15px;
      font-size: 1.1rem;
    }

    #participants {
      width: 120px;
      font-size: 1.2rem;
      font-weight: 600;
    }

    .results-card {
      background: linear-gradient(135deg, rgba(72, 187, 120, 0.2), rgba(56, 178, 172, 0.2));
      color: white;
      border: 1px solid rgba(72, 187, 120, 0.3);
      max-height: none;
      overflow: visible;
    }

    .results-card h2 {
      color: white;
      margin-bottom: 20px;
    }

    .results-card h2::before {
      background: rgba(72, 187, 120, 0.6);
    }

    .participant-result {
      margin: 20px 0;
      padding: 20px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      overflow: hidden; /* Previene overflow dei risultati */
      word-wrap: break-word;
      max-width: 100%;
      box-sizing: border-box;
    }

    .participant-title {
      font-size: 1.2rem;
      font-weight: 600;
      margin-bottom: 15px;
      color: #63b3ed;
      text-align: center;
      overflow: hidden;
      max-width: 100%;
      box-sizing: border-box;
      word-wrap: break-word;
    }

    .item-distribution {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 10px;
      margin: 8px 0;
      padding: 8px 12px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 6px;
      overflow: hidden; /* Previene overflow delle distribuzioni */
      word-wrap: break-word;
      min-width: 0; /* Permette alla griglia di ridursi */
      max-width: 100%;
      box-sizing: border-box;
    }

    .total-cost {
      text-align: center;
      margin-top: 15px;
      padding: 12px;
      background: rgba(72, 187, 120, 0.2);
      border-radius: 8px;
      font-weight: 600;
      border: 1px solid rgba(72, 187, 120, 0.3);
      overflow: hidden;
      max-width: 100%;
      box-sizing: border-box;
      word-wrap: break-word;
    }

    .empty-state {
      text-align: center;
      color: #a0aec0;
      font-style: italic;
      padding: 40px;
      overflow: hidden;
      max-width: 100%;
      box-sizing: border-box;
      word-wrap: break-word;
    }

    .currency-br {
      color: #68d391;
      font-weight: 600;
    }
    
    .currency-a {
      color: #c0c0c0;
      font-weight: 600;
    }
    
    .currency-mixed {
      color: #68d391;
      font-weight: 600;
    }

    .logo {
      width: 40px;
      height: 40px;
      margin-right: 15px;
      vertical-align: middle;
      max-width: 100%;
      box-sizing: border-box;
      overflow: hidden;
      flex-shrink: 0;
    }

    .loading {
      text-align: center;
      color: #a0aec0;
      padding: 40px;
      font-style: italic;
      overflow: hidden;
      max-width: 100%;
      box-sizing: border-box;
      word-wrap: break-word;
    }

    .error {
      text-align: center;
      color: #f56565;
      padding: 20px;
      background: rgba(245, 101, 101, 0.1);
      border-radius: 8px;
      border: 1px solid rgba(245, 101, 101, 0.3);
      overflow: hidden;
      max-width: 100%;
      box-sizing: border-box;
      word-wrap: break-word;
    }

    .warning {
      text-align: center;
      color: #ed8936;
      padding: 20px;
      background: rgba(237, 137, 54, 0.1);
      border-radius: 8px;
      border: 1px solid rgba(237, 137, 54, 0.3);
      overflow: hidden;
      max-width: 100%;
      box-sizing: border-box;
      word-wrap: break-word;
    }

    .contacts-section {
      background: rgba(30, 35, 55, 0.8);
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      padding: 20px 40px;
      text-align: center;
      margin-top: 30px;
      overflow: hidden;
      max-width: 100%;
      box-sizing: border-box;
    }
 
     .contacts-title {
       color: #63b3ed;
       font-size: 1.1rem;
       margin-bottom: 15px;
       font-weight: 600;
       overflow: hidden;
       max-width: 100%;
       box-sizing: border-box;
       word-wrap: break-word;
     }
 
     .contact-item {
       display: inline-block;
       margin: 0 15px 8px 0;
       padding: 8px 16px;
       background: rgba(99, 179, 237, 0.1);
       border: 1px solid rgba(99, 179, 237, 0.3);
       border-radius: 20px;
       color: #ffffff;
       text-decoration: none;
       transition: all 0.3s ease;
       font-weight: 500;
       font-size: 0.9rem;
       overflow: hidden;
       max-width: 100%;
       box-sizing: border-box;
       word-wrap: break-word;
     }
 
     .contact-item:hover {
       background: rgba(99, 179, 237, 0.2);
       border-color: rgba(99, 179, 237, 0.5);
       transform: translateY(-2px);
     }
 
     .contact-item strong {
       color: #63b3ed;
     }
 
    .fractional-display {
      color: #fbb6ce;
      font-size: 0.9em;
      font-style: italic;
      overflow: hidden;
      max-width: 100%;
      box-sizing: border-box;
      word-wrap: break-word;
    }

    .homepage-link {
      position: absolute;
      top: 20px;
      right: 20px;
      color: #63b3ed;
      text-decoration: none;
      font-size: 0.9rem;
      padding: 8px 12px;
      border: 1px solid rgba(99, 179, 237, 0.3);
      border-radius: 8px;
      transition: all 0.3s ease;
      cursor: pointer;
      display: block;
      width: auto;
      height: auto;
      z-index: 10;
      background: transparent;
      overflow: hidden;
      max-width: 100%;
      box-sizing: border-box;
      word-wrap: break-word;
      white-space: nowrap;
    }

    .homepage-link:hover {
      background: rgba(99, 179, 237, 0.1);
    }

    .homepage-link:active {
      transform: scale(0.95);
    }

   </style>
 </head>
 <body>
   <div class="container">
           <header>
                 <h1><img src="../logo.png" alt="Abaco Logo" class="logo" onerror="this.style.display='none'; this.nextElementSibling.style.display='inline';">‚öíÔ∏è Abaco per Divisione Abisso</h1>
        <p class="subtitle">Divisore intelligente per bottini di abisso</p>
                 <a href="../" class="homepage-link">üè† Homepage</a>
      </header>
 
     <main>
       <div class="grid">
                   <div class="card">
            <h2>Lista Materiali
              <button id="reload-data" style="float: right; background: rgba(99, 179, 237, 0.2); border: 1px solid rgba(99, 179, 237, 0.5); color: #63b3ed; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 0.8rem;" onclick="reloadData()">üîÑ Ricarica Dati</button>
            </h2>
            <div id="product-list">
              <div class="loading">Caricamento materiali in corso...</div>
            </div>
          </div>
 
         <div>
           <div class="card participants-section">
             <h2>Partecipanti</h2>
             <label class="participants-label">Numero di partecipanti:</label>
             <input type="number" id="participants" min="1" value="1">
             
             <div id="participant-classes" style="margin-top: 20px;">
               <!-- Le classi dei partecipanti verranno generate dinamicamente -->
             </div>
             
             <div class="priority-info">
               <h4>üìã Sistema di Priorit√† e Stelline</h4>
               <ul class="priority-list">
                 <li><strong>Bassa priorit√†:</strong> Guerrieri, Ombre</li>
                 <li><strong>Priorit√† Stagno:</strong> Bardi (almeno uno)</li>
                 <li><strong>Priorit√† Maghi/Cacciatori:</strong> Materiali specifici per classe</li>
                 <li><strong>Bilanciamento stelline:</strong> I partecipanti a bassa priorit√† ricevono materiali equivalenti in stelline</li>
                 <li><strong>‚≠ê 1 stellina:</strong> brim, carnemarcia, quarzo, therium, occhio</li>
                 <li><strong>‚≠ê‚≠ê 2 stelline:</strong> blaze powder, membrana, slime ball, prismarine shard</li>
                 <li><strong>‚≠ê‚≠ê‚≠ê 3 stelline:</strong> lost soul, demon heart</li>
               </ul>
             </div>
           </div>
 
           <div class="card results-card">
             <h2>Distribuzione</h2>
             <div id="distribution-results"></div>
           </div>
         </div>
       </div>
     </main>
 
           <div class="contacts-section">
        <div class="contacts-title">üìû Contatti</div>
        <div>
          <span class="contact-item">
            üéÆ Discord: <strong>picciobeffa</strong>
          </span>
          <span class="contact-item">
            üì± Telegram: <strong>@piccionenberg</strong>
          </span>
        </div>
        <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid rgba(255, 255, 255, 0.1); display: flex; align-items: center; justify-content: center; gap: 10px; font-size: 0.9rem; color: #a0aec0;">
                     <img src="../logo.png" alt="Sevcon Logo" style="width: 16px; height: 16px; border-radius: 3px;" onerror="this.style.display='none';">
          ¬© 2024 Sevcon by piccionenberg - Creato con ‚ù§Ô∏è per la community gaming
        </div>
      </div>
   </div>
 
   <script>
     let defaultProducts = [];
     let products = [];
     const distributionResults = document.getElementById("distribution-results");
     const participantsInput = document.getElementById("participants");
     const participantClassesContainer = document.getElementById("participant-classes");
     
     // Sistema di priorit√† basato sul file fornito
     const prioritySystem = {
       // Bassa priorit√†
       lowPriority: ['Guerriero', 'Ombra'],
       
       // Priorit√† Stagno
       tinPriority: ['Bardo'],
       
       // Priorit√† per classe e tier
       classPriority: {
         'Mago': {
           'Novizio': ['Brim'],
           'Avanzato': ['Occhio di ragno'],
           'Esperto': ['Membrana'],
           'Custode': ['Prismarine Shard'],
           'Maestro': ['Lost Soul']
         },
         'Cacciatore': {
           'Avanzato': ['Ametista'],
           'Esperto': ['Membrana'],
           'Custode': ['Prismarine Shard']
         },
         'Raccoglitore': {
           'Avanzato': ['Occhio di ragno'],
           'Esperto': ['Membrana'],
           'Custode': ['Prismarine Shard'],
           'Maestro': ['Lost Soul']
         }
       }
     };
     
     // Sistema di stelline per bilanciamento
     const starSystem = {
       // 1 stellina
       oneStar: ['brim', 'carnemarcia', 'quarzo', 'therium', 'occhio'],
       // 2 stelline  
       twoStars: ['blaze powder', 'membrana', 'slime ball', 'prismarine shard'],
       // 3 stelline
       threeStars: ['lost soul', 'demon heart']
     };
     
     // Classi disponibili
     const availableClasses = ['Guerriero', 'Mago', 'Cacciatore', 'Bardo', 'Raccoglitore', 'Ombra'];
     
     // Array per memorizzare le classi dei partecipanti
     let participantClasses = [];

     // Funzione per aggiornare i controlli delle classi
     function updateParticipantClasses() {
       const participants = parseInt(participantsInput.value) || 1;
       participantClassesContainer.innerHTML = '';
       
       // Inizializza l'array se necessario
       while (participantClasses.length < participants) {
         participantClasses.push('Guerriero'); // Default
       }
       
       // Tronca l'array se ci sono troppi partecipanti
       participantClasses = participantClasses.slice(0, participants);
       
       for (let i = 0; i < participants; i++) {
         const controlDiv = document.createElement('div');
         controlDiv.className = 'participant-controls';
         
         const label = document.createElement('div');
         label.className = 'participant-label';
         label.textContent = `Partecipante ${i + 1}:`;
         
         const select = document.createElement('select');
         select.className = 'class-select';
         select.id = `participant-${i}-class`;
         
         availableClasses.forEach(className => {
           const option = document.createElement('option');
           option.value = className;
           option.textContent = className;
           if (className === participantClasses[i]) {
             option.selected = true;
           }
           select.appendChild(option);
         });
         
         select.addEventListener('change', () => {
           participantClasses[i] = select.value;
           updateDistribution();
         });
         
         controlDiv.appendChild(label);
         controlDiv.appendChild(select);
         participantClassesContainer.appendChild(controlDiv);
       }
     }

     // Funzione per calcolare la priorit√† di un materiale per un partecipante
     function calculatePriority(itemName, participantClass, itemTier) {
       let priority = 0;
       
       // Priorit√† bassa per Guerrieri e Ombre
       if (prioritySystem.lowPriority.includes(participantClass)) {
         priority = 1;
       }
       
       // Priorit√† Stagno per Bardi
       if (prioritySystem.tinPriority.includes(participantClass) && 
           itemName.toLowerCase().includes('stagno')) {
         priority = 3;
       }
       
       // Priorit√† per classe e tier specifici
       if (prioritySystem.classPriority[participantClass] && 
           prioritySystem.classPriority[participantClass][itemTier]) {
         const priorityItems = prioritySystem.classPriority[participantClass][itemTier];
         if (priorityItems.some(priorityItem => 
             itemName.toLowerCase().includes(priorityItem.toLowerCase()))) {
           priority = 4;
         }
       }
       
       // Priorit√† media per altri materiali
       if (priority === 0) {
         priority = 2;
       }
       
       return priority;
     }

     // Funzione per ottenere il numero di stelline di un materiale
     function getItemStars(itemName) {
       const name = itemName.toLowerCase();
       
       if (starSystem.oneStar.some(star => name.includes(star))) {
         return 1;
       } else if (starSystem.twoStars.some(star => name.includes(star))) {
         return 2;
       } else if (starSystem.threeStars.some(star => name.includes(star))) {
         return 3;
       }
       
       return 1; // Default a 1 stellina per materiali non specificati
     }

     // Funzione per trovare materiali equivalenti in stelline
     function findEquivalentItems(targetStars, availableItems, excludeItems = []) {
       const equivalents = [];
       
       // Cerca materiali con lo stesso numero di stelline
       availableItems.forEach(item => {
         if (excludeItems.includes(item.name)) return;
         
         const itemStars = getItemStars(item.name);
         if (itemStars === targetStars && item.qty > 0) {
           equivalents.push({
             name: item.name,
             qty: item.qty,
             price: item.price,
             stars: itemStars
           });
         }
       });
       
       return equivalents;
     }

     // Funzione per calcolare il valore in stelline di un set di oggetti
     function calculateStarValue(items) {
       return items.reduce((total, item) => {
         const stars = getItemStars(item.name);
         return total + (item.qty * stars);
       }, 0);
     }

     // Carica i prodotti dal file JSON
     async function loadProducts() {
       const productList = document.getElementById("product-list");
       let jsonLoaded = false;
       
       // Tempo di caricamento hardcoded variabile (1-4 secondi)
       const loadingTime = Math.floor(Math.random() * 3000) + 1000; // da 1000ms a 4000ms
       
       // Mostra sempre il messaggio di caricamento iniziale
       productList.innerHTML = `
         <div class="loading">
           ‚è≥ Caricamento dati in corso...<br>
           <small>Connessione al database materiali</small>
         </div>
       `;
       
                // Aspetta il tempo di caricamento simulato
         await new Promise(resolve => setTimeout(resolve, loadingTime));
         
         // Debug: mostra informazioni sul caricamento
         console.log('=== DEBUG CARICAMENTO JSON ===');
         console.log('Tempo di caricamento simulato:', loadingTime + 'ms');
       
       try {
         // Debug: mostra il percorso corrente
         console.log('Tentativo di caricamento JSON da:', window.location.href);
         console.log('Directory corrente:', window.location.pathname);
         console.log('URL base:', window.location.origin + window.location.pathname);
         
         // Prova prima con window.fs (ambiente Claude)
         if (window.fs && window.fs.readFile) {
           console.log('Usando window.fs per caricare il JSON...');
           const data = await window.fs.readFile('./oggetti_abaco.json', { encoding: 'utf8' });
           defaultProducts = JSON.parse(data);
           jsonLoaded = true;
           console.log('JSON caricato con successo via window.fs');
         } else {
           // Fallback per browser normali - carica via fetch con timeout
           console.log('Usando fetch per caricare il JSON...');
           const controller = new AbortController();
           const timeoutId = setTimeout(() => controller.abort(), 10000); // 10 secondi timeout
           
           try {
             // Prova diversi percorsi per il file JSON
             const possiblePaths = [
               './oggetti_abaco.json',
               'oggetti_abaco.json',
               '../abaco/oggetti_abaco.json',
               'abaco/oggetti_abaco.json',
               window.location.origin + '/abaco/oggetti_abaco.json',
               window.location.origin + '/sevc0n.github.io/abaco/oggetti_abaco.json'
             ];
             
             let pathSuccess = false;
             for (const path of possiblePaths) {
               try {
                 console.log(`Tentativo con path: ${path}`);
                 const response = await fetch(`${path}?v=${new Date().getTime()}`, { 
                   signal: controller.signal 
                 });
                 
                 if (response.ok) {
                   console.log(`JSON caricato con successo da: ${path}`);
                   defaultProducts = await response.json();
                   jsonLoaded = true;
                   pathSuccess = true;
                   break;
                 }
               } catch (pathError) {
                 console.log(`Path ${path} fallito:`, pathError.message);
                 continue;
               }
             }
             
             clearTimeout(timeoutId);
             
             if (!pathSuccess) {
               throw new Error('Nessun percorso valido trovato per il file JSON');
             }
           } catch (fetchError) {
             if (fetchError.name === 'AbortError') {
               throw new Error('Timeout: il caricamento del file JSON ha richiesto troppo tempo');
             }
             throw fetchError;
           }
         }
         
                 if (jsonLoaded) {
          // Debug: mostra i dati caricati
          console.log('Prodotti caricati dal JSON:', defaultProducts);
          console.log('Numero di prodotti:', defaultProducts.length);
          
          products = [...defaultProducts.map(p => ({ ...p, qty: 0 }))];
          renderMain();
          
          // Mostra messaggio di successo con timestamp
          setTimeout(() => {
            const timestamp = new Date().toLocaleTimeString();
            console.log(`Dati aggiornati alle ${timestamp}`);
          }, 1000);
        } else {
          // Fallback con dati hardcoded se il JSON non pu√≤ essere caricato
          console.warn('Caricamento JSON fallito, uso dati di fallback...');
          defaultProducts = [
            { name: "Stagno grezzo", price: 12, category: "Cristalli", subcategory: "Metalli", tier: "Novizio" },
            { name: "Rame grezzo", price: 20, category: "Cristalli", subcategory: "Metalli", tier: "Avanzato" },
            { name: "Ferro grezzo", price: 27, category: "Cristalli", subcategory: "Metalli", tier: "Esperto" },
            { name: "Oro grezzo", price: 50, category: "Cristalli", subcategory: "Metalli", tier: "Custode" },
            { name: "Diamante grezzo", price: 500, category: "Cristalli", subcategory: "Metalli", tier: "Maestro" }
          ];
          
          products = [...defaultProducts.map(p => ({ ...p, qty: 0 }))];
          renderMain();
          
          // Mostra avviso all'utente
          setTimeout(() => {
            productList.innerHTML = `
              <div class="warning">
                ‚ö†Ô∏è Caricamento dati limitato<br>
                <small>Usando dati di fallback - alcuni materiali potrebbero non essere disponibili</small>
                <br><br>
                <strong>Per assistenza contatta:</strong><br>
                üéÆ Discord: <strong>picciobeffa</strong><br>
                üì± Telegram: <strong>@piccionenberg</strong>
              </div>
            `;
          }, 2000);
        }
       } catch (error) {
         console.error('Errore nel caricamento dei prodotti:', error);
         
         // Mostra messaggio di caricamento aggiuntivo se fallisce
         productList.innerHTML = `
           <div class="loading">
             ‚è≥ Caricamento dati in corso...<br>
             <small>Tentativo di connessione al database materiali</small>
           </div>
         `;
         
         // Aspetta 10 secondi prima di mostrare l'errore finale
         setTimeout(() => {
           productList.innerHTML = `
             <div class="error">
               ‚ùå Impossibile caricare i dati dei materiali<br>
               <br>
               <strong>Per assistenza contatta:</strong><br>
               üéÆ Discord: <strong>picciobeffa</strong><br>
               üì± Telegram: <strong>@piccionenberg</strong>
             </div>
           `;
         }, 10000); // Aspetta 10 secondi prima di mostrare l'errore
       }
     }
 
     function getTierClass(tier) {
       return `tier-${tier.toLowerCase()}`;
     }
 
     // Funzione per formattare la valuta (conversione automatica br -> a)
     function formatCurrency(value) {
       if (value >= 100) {
         const argenti = Math.floor(value / 100);
         const bronzini = value % 100;
         
         if (bronzini === 0) {
           return `${argenti}a`;
         } else {
           const bronziniDisplay = (bronzini % 1 === 0) ? bronzini.toString() : bronzini.toFixed(1);
           return `${argenti}a ${bronziniDisplay}br`;
         }
       } else {
         const display = (value % 1 === 0) ? value.toString() : value.toFixed(1);
         return `${display}br`;
       }
     }
 
     // Funzione per applicare la classe CSS corretta in base al valore
     function getCurrencyClass(value) {
       if (value >= 100) {
         return 'currency-mixed';
       } else {
         return 'currency-br';
       }
     }
 
     function renderMain() {
       const productList = document.getElementById("product-list");
       productList.innerHTML = "";
 
       const categories = [...new Set(products.map(p => p.category))];
       
       categories.forEach(category => {
         const categoryDiv = document.createElement("div");
         categoryDiv.className = "category-section";
         
         const categoryTitle = document.createElement("h3");
         categoryTitle.className = "category-title";
         categoryTitle.textContent = `Materiali dai ${category}`;
         categoryDiv.appendChild(categoryTitle);
 
         if (category === "Cristalli") {
           // Per i cristalli, raggruppa per sottocategorie
           const subcategories = [...new Set(products.filter(p => p.category === category).map(p => p.subcategory))];
           
           subcategories.forEach(subcategory => {
             const subcategoryDiv = document.createElement("div");
             subcategoryDiv.style.marginLeft = "20px";
             subcategoryDiv.style.marginBottom = "20px";
             subcategoryDiv.style.overflow = "hidden";
             subcategoryDiv.style.maxWidth = "100%";
             subcategoryDiv.style.boxSizing = "border-box";
             
             const subcategoryTitle = document.createElement("h4");
             subcategoryTitle.style.color = "#a0aec0";
             subcategoryTitle.style.fontSize = "1rem";
             subcategoryTitle.style.marginBottom = "10px";
             subcategoryTitle.style.fontWeight = "500";
             subcategoryTitle.style.overflow = "hidden";
             subcategoryTitle.style.wordWrap = "break-word";
             subcategoryTitle.style.maxWidth = "100%";
             subcategoryTitle.textContent = subcategory;
             subcategoryDiv.appendChild(subcategoryTitle);
             
             const subcategoryProducts = products.filter(p => p.category === category && p.subcategory === subcategory);
             
             subcategoryProducts.forEach((p) => {
               const globalIndex = products.indexOf(p);
               const div = createProductElement(p, globalIndex);
               subcategoryDiv.appendChild(div);
             });
             
             categoryDiv.appendChild(subcategoryDiv);
           });
         } else {
           // Per altre categorie, mostra direttamente i prodotti
           const categoryProducts = products.filter(p => p.category === category);
           
           categoryProducts.forEach((p) => {
             const globalIndex = products.indexOf(p);
             const div = createProductElement(p, globalIndex);
             categoryDiv.appendChild(div);
           });
         }
         
         productList.appendChild(categoryDiv);
       });
 
       updateDistribution();
     }
 
     function createProductElement(p, globalIndex) {
       const div = document.createElement("div");
       div.className = "product";

       const nameContainer = document.createElement("div");
       const name = document.createElement("span");
       name.className = "product-name";
       name.textContent = p.name;
       
       const tierBadge = document.createElement("span");
       tierBadge.className = `tier-badge ${getTierClass(p.tier)}`;
       tierBadge.textContent = p.tier;
       
       nameContainer.appendChild(name);
       nameContainer.appendChild(tierBadge);

       const price = document.createElement("span");
       price.className = `product-price ${getCurrencyClass(p.price)}`;
       price.textContent = formatCurrency(p.price);

       // Container per i controlli di quantit√†
       const quantityContainer = document.createElement("div");
       quantityContainer.className = "quantity-container";

       // Pulsante meno
       const minusBtn = document.createElement("button");
       minusBtn.className = "quantity-btn";
       minusBtn.textContent = "‚àí";
       minusBtn.type = "button";
       minusBtn.addEventListener("click", () => {
         const currentValue = parseInt(qty.value) || 0;
         if (currentValue > 0) {
           qty.value = currentValue - 1;
           products[globalIndex].qty = currentValue - 1;
           updateDistribution();
         }
       });

       // Input quantit√†
       const qty = document.createElement("input");
       qty.type = "number";
       qty.min = "0";
       qty.className = "quantity-input";
       qty.value = p.qty > 0 ? p.qty : "";
       qty.placeholder = "0";

       qty.addEventListener("input", () => {
         products[globalIndex].qty = parseInt(qty.value) || 0;
         updateDistribution();
       });

       // Pulsante pi√π
       const plusBtn = document.createElement("button");
       plusBtn.className = "quantity-btn";
       plusBtn.textContent = "+";
       plusBtn.type = "button";
       plusBtn.addEventListener("click", () => {
         const currentValue = parseInt(qty.value) || 0;
         qty.value = currentValue + 1;
         products[globalIndex].qty = currentValue + 1;
         updateDistribution();
       });

       // Assembla il container
       quantityContainer.appendChild(minusBtn);
       quantityContainer.appendChild(qty);
       quantityContainer.appendChild(plusBtn);

       div.appendChild(nameContainer);
       div.appendChild(price);
       div.appendChild(quantityContainer);
       
       return div;
     }
 
     function updateDistribution() {
       const participants = parseInt(participantsInput.value) || 1;
       const activeItems = products.filter(p => p.qty > 0);
       
       if (activeItems.length === 0) {
         distributionResults.innerHTML = '<div class="empty-state">Seleziona alcuni materiali per vedere la distribuzione</div>';
         return;
       }

       distributionResults.innerHTML = "";
       
       // Array per tenere traccia dei valori di ogni partecipante
       const participantValues = new Array(participants).fill(0);
       const participantItems = new Array(participants).fill().map(() => []);
       const participantStarValues = new Array(participants).fill(0);
       
       // FASE 1: Distribuzione base equa
       activeItems.forEach(item => {
         const itemsPerParticipant = Math.floor(item.qty / participants);
         
         if (itemsPerParticipant > 0) {
           for (let i = 0; i < participants; i++) {
             participantItems[i].push({
               name: item.name,
               qty: itemsPerParticipant,
               price: item.price,
               stars: getItemStars(item.name),
               isBase: true
             });
             participantValues[i] += itemsPerParticipant * item.price;
             participantStarValues[i] += itemsPerParticipant * getItemStars(item.name);
           }
         }
       });
       
       // FASE 2: Distribuzione dell'esubero con sistema di stelline
       activeItems.forEach(item => {
         const itemsPerParticipant = Math.floor(item.qty / participants);
         const totalDistributed = itemsPerParticipant * participants;
         const remaining = item.qty - totalDistributed;
         
         if (remaining > 0) {
           const itemStars = getItemStars(item.name);
           
           // Calcola priorit√† per ogni partecipante per questo item
           const participantPriorities = [];
           for (let i = 0; i < participants; i++) {
             const priority = calculatePriority(item.name, participantClasses[i] || 'Guerriero', item.tier);
             participantPriorities.push({
               index: i,
               priority: priority,
               currentValue: participantValues[i],
               currentStarValue: participantStarValues[i]
             });
           }
           
           // Ordina per priorit√† (pi√π alta prima) e poi per valore stelline (pi√π basso prima)
           participantPriorities.sort((a, b) => {
             if (a.priority !== b.priority) {
               return b.priority - a.priority; // Priorit√† pi√π alta prima
             }
             return a.currentStarValue - b.currentStarValue; // Valore stelline pi√π basso prima
           });
           
           // Distribuisci l'esubero seguendo l'ordine di priorit√†
           let remainingToDistribute = remaining;
           for (const participant of participantPriorities) {
             if (remainingToDistribute <= 0) break;
             
             const qtyToGive = Math.min(1, remainingToDistribute);
             participantItems[participant.index].push({
               name: item.name,
               qty: qtyToGive,
               price: item.price,
               stars: itemStars,
               isEsubero: true,
               priority: participant.priority
             });
             participantValues[participant.index] += qtyToGive * item.price;
             participantStarValues[participant.index] += qtyToGive * itemStars;
             remainingToDistribute -= qtyToGive;
           }
         }
       });
       
       // FASE 3: Bilanciamento con stelline equivalenti
       // Trova partecipanti con priorit√† bassa che hanno ricevuto materiali ad alta priorit√†
       const lowPriorityParticipants = [];
       const highPriorityParticipants = [];
       
       for (let i = 0; i < participants; i++) {
         const participantClass = participantClasses[i] || 'Guerriero';
         if (prioritySystem.lowPriority.includes(participantClass)) {
           lowPriorityParticipants.push(i);
         } else {
           highPriorityParticipants.push(i);
         }
       }
       
       // Calcola il valore stelline medio dei partecipanti ad alta priorit√†
       if (highPriorityParticipants.length > 0) {
         const avgHighPriorityStarValue = highPriorityParticipants.reduce((sum, idx) => 
           sum + participantStarValues[idx], 0) / highPriorityParticipants.length;
         
         // Bilanciamento per partecipanti a bassa priorit√†
         lowPriorityParticipants.forEach(participantIdx => {
           const currentStarValue = participantStarValues[participantIdx];
           const deficit = avgHighPriorityStarValue - currentStarValue;
           
           if (deficit > 0) {
             // Trova materiali equivalenti per bilanciare
             const availableItems = activeItems.filter(item => item.qty > 0);
             const participantItemsNames = participantItems[participantIdx].map(item => item.name);
             
             // Cerca materiali con 1, 2, 3 stelline per bilanciare
             for (let targetStars = 1; targetStars <= 3 && deficit > 0; targetStars++) {
               const equivalents = findEquivalentItems(targetStars, availableItems, participantItemsNames);
               
               if (equivalents.length > 0) {
                 // Prendi il primo materiale equivalente disponibile
                 const equivalent = equivalents[0];
                 const qtyNeeded = Math.min(Math.ceil(deficit / targetStars), equivalent.qty);
                 
                 if (qtyNeeded > 0) {
                   participantItems[participantIdx].push({
                     name: equivalent.name,
                     qty: qtyNeeded,
                     price: equivalent.price,
                     stars: targetStars,
                     isCompensation: true,
                     reason: `Bilanciamento stelline (${targetStars}‚≠ê)`
                   });
                   participantValues[participantIdx] += qtyNeeded * equivalent.price;
                   participantStarValues[participantIdx] += qtyNeeded * targetStars;
                   
                   // Aggiorna la quantit√† disponibile
                   const itemIndex = activeItems.findIndex(item => item.name === equivalent.name);
                   if (itemIndex !== -1) {
                     activeItems[itemIndex].qty -= qtyNeeded;
                   }
                 }
               }
             }
           }
         });
       }
       
       // Mostra messaggio informativo sul sistema di priorit√† e stelline
       const infoDiv = document.createElement("div");
       infoDiv.style.textAlign = "center";
       infoDiv.style.marginTop = "20px";
       infoDiv.style.padding = "15px";
       infoDiv.style.background = "rgba(99, 179, 237, 0.1)";
       infoDiv.style.borderRadius = "8px";
       infoDiv.style.border = "1px solid rgba(99, 179, 237, 0.3)";
       infoDiv.style.color = "#63b3ed";
       infoDiv.style.fontSize = "0.9rem";
       infoDiv.innerHTML = `
         üéØ <strong>Distribuzione con priorit√† e stelline:</strong><br>
         ‚Ä¢ Materiali distribuiti per priorit√† di classe<br>
         ‚Ä¢ Bilanciamento automatico con stelline equivalenti<br>
         ‚Ä¢ ‚≠ê 1 stellina: brim, carnemarcia, quarzo, therium, occhio<br>
         ‚Ä¢ ‚≠ê‚≠ê 2 stelline: blaze powder, membrana, slime ball, prismarine shard<br>
         ‚Ä¢ ‚≠ê‚≠ê‚≠ê 3 stelline: lost soul, demon heart
       `;
       
       distributionResults.appendChild(infoDiv);
       
               // Mostra cosa prende ogni partecipante (parte normale, non esubero)
        const baseDistributionDiv = document.createElement("div");
        baseDistributionDiv.style.marginBottom = "30px";
        baseDistributionDiv.style.padding = "20px";
        baseDistributionDiv.style.background = "rgba(72, 187, 120, 0.1)";
        baseDistributionDiv.style.borderRadius = "12px";
        baseDistributionDiv.style.border = "1px solid rgba(72, 187, 120, 0.3)";
        
        const baseTitle = document.createElement("h3");
        baseTitle.style.color = "#68d391";
        baseTitle.style.fontSize = "1.2rem";
        baseTitle.style.marginBottom = "15px";
        baseTitle.style.textAlign = "center";
        baseTitle.textContent = "üéØ Ogni partecipante prende:";
        baseDistributionDiv.appendChild(baseTitle);
        
        // Raggruppa gli oggetti normali (non esubero) per nome
        const baseItems = {};
        for (let i = 0; i < participants; i++) {
          participantItems[i].forEach(item => {
            if (!item.isEsubero) {
              if (!baseItems[item.name]) {
                baseItems[item.name] = {
                  name: item.name,
                  qty: item.qty,
                  price: item.price
                };
              }
            }
          });
        }
        
        // Mostra gli oggetti base distribuiti
        Object.values(baseItems).forEach(item => {
          const itemDiv = document.createElement("div");
          itemDiv.style.display = "flex";
          itemDiv.style.justifyContent = "space-between";
          itemDiv.style.alignItems = "center";
          itemDiv.style.padding = "8px 12px";
          itemDiv.style.margin = "5px 0";
          itemDiv.style.background = "rgba(255, 255, 255, 0.05)";
          itemDiv.style.borderRadius = "6px";
          
          const itemName = document.createElement("span");
          itemName.textContent = `${item.name} x${item.qty}`;
          itemName.style.color = "#ffffff";
          
          const itemCost = document.createElement("span");
          const cost = item.qty * item.price;
          itemCost.className = getCurrencyClass(cost);
          itemCost.textContent = formatCurrency(cost);
          
          itemDiv.appendChild(itemName);
          itemDiv.appendChild(itemCost);
          baseDistributionDiv.appendChild(itemDiv);
        });
        
        distributionResults.appendChild(baseDistributionDiv);
        
        // Mostra i risultati per ogni partecipante (solo esubero e totali)
        for (let i = 0; i < participants; i++) {
          const participantDiv = document.createElement("div");
          participantDiv.className = "participant-result";
          
          const title = document.createElement("div");
          title.className = "participant-title";
          const participantClass = participantClasses[i] || 'Guerriero';
          const totalStars = participantItems[i].reduce((sum, item) => sum + (item.stars * item.qty), 0);
          title.innerHTML = `Partecipante ${i + 1} (${participantClass}) - ‚≠ê ${totalStars} stelline totali`;
          participantDiv.appendChild(title);
          
          // Mostra oggetti dell'esubero e compensazioni
          const specialItems = participantItems[i].filter(item => item.isEsubero || item.isCompensation);
          
          if (specialItems.length > 0) {
            // Raggruppa gli oggetti per nome e tipo
            const groupedItems = {};
            specialItems.forEach(item => {
              const key = `${item.name}_${item.isCompensation ? 'comp' : 'esubero'}`;
              if (!groupedItems[key]) {
                groupedItems[key] = {
                  name: item.name,
                  qty: 0,
                  price: item.price,
                  stars: item.stars,
                  priority: item.priority,
                  isCompensation: item.isCompensation,
                  reason: item.reason
                };
              }
              groupedItems[key].qty += item.qty;
            });
            
            // Mostra gli oggetti raggruppati
            Object.values(groupedItems).forEach(item => {
              const itemDiv = document.createElement("div");
              itemDiv.className = "item-distribution";
              
              // Colore basato sul tipo e priorit√†
              if (item.isCompensation) {
                itemDiv.style.background = "rgba(168, 85, 247, 0.2)";
                itemDiv.style.border = "1px solid rgba(168, 85, 247, 0.3)";
              } else if (item.priority === 4) {
                itemDiv.style.background = "rgba(72, 187, 120, 0.2)";
                itemDiv.style.border = "1px solid rgba(72, 187, 120, 0.3)";
              } else if (item.priority === 3) {
                itemDiv.style.background = "rgba(99, 179, 237, 0.2)";
                itemDiv.style.border = "1px solid rgba(99, 179, 237, 0.3)";
              } else {
                itemDiv.style.background = "rgba(237, 137, 54, 0.2)";
                itemDiv.style.border = "1px solid rgba(237, 137, 54, 0.3)";
              }
              
              const itemName = document.createElement("span");
              let icon = "üì¶";
              if (item.isCompensation) {
                icon = "‚öñÔ∏è";
              } else if (item.priority === 4) {
                icon = "‚≠ê";
              } else if (item.priority === 3) {
                icon = "üéØ";
              }
              
              const starDisplay = "‚≠ê".repeat(item.stars);
              itemName.innerHTML = `${icon} ${item.name} x${item.qty} ${starDisplay}`;
              
              const itemCost = document.createElement("span");
              const cost = item.qty * item.price;
              itemCost.className = getCurrencyClass(cost);
              itemCost.textContent = formatCurrency(cost);
              
              itemDiv.appendChild(itemName);
              itemDiv.appendChild(itemCost);
              participantDiv.appendChild(itemDiv);
              
              // Mostra motivo per compensazioni
              if (item.isCompensation && item.reason) {
                const reasonDiv = document.createElement("div");
                reasonDiv.style.fontSize = "0.8rem";
                reasonDiv.style.color = "#a0aec0";
                reasonDiv.style.fontStyle = "italic";
                reasonDiv.style.marginTop = "2px";
                reasonDiv.textContent = `(${item.reason})`;
                itemDiv.appendChild(reasonDiv);
              }
            });
          } else {
            // Se non ha oggetti speciali, mostra un messaggio
            const noSpecialDiv = document.createElement("div");
            noSpecialDiv.style.textAlign = "center";
            noSpecialDiv.style.padding = "15px";
            noSpecialDiv.style.color = "#a0aec0";
            noSpecialDiv.style.fontStyle = "italic";
            noSpecialDiv.textContent = "Nessun oggetto speciale (solo distribuzione base)";
            participantDiv.appendChild(noSpecialDiv);
          }
          
          // Mostra il totale (incluso esubero e compensazioni)
          const totalDiv = document.createElement("div");
          totalDiv.className = "total-cost";
          const formattedTotal = formatCurrency(participantValues[i]);
          const totalStars = participantItems[i].reduce((sum, item) => sum + (item.stars * item.qty), 0);
          totalDiv.innerHTML = `
            Totale: <span class="${getCurrencyClass(participantValues[i])}">${formattedTotal}</span><br>
            <small>‚≠ê ${totalStars} stelline totali</small>
          `;
          participantDiv.appendChild(totalDiv);
          
          distributionResults.appendChild(participantDiv);
        }
       
               // Non serve pi√π mostrare una sezione esubero separata
        // Tutti gli oggetti sono stati distribuiti tra i partecipanti
     }
 
         // Funzione per ricaricare i dati manualmente
    async function reloadData() {
      const reloadButton = document.getElementById('reload-data');
      const originalText = reloadButton.innerHTML;
      
      // Mostra che sta caricando
      reloadButton.innerHTML = '‚è≥ Caricando...';
      reloadButton.disabled = true;
      
      try {
        await loadProducts();
        reloadButton.innerHTML = '‚úÖ Ricaricato!';
        
        // Torna al testo originale dopo 2 secondi
        setTimeout(() => {
          reloadButton.innerHTML = originalText;
          reloadButton.disabled = false;
        }, 2000);
      } catch (error) {
        reloadButton.innerHTML = '‚ùå Errore';
        console.error('Errore nel ricaricamento:', error);
        
        // Torna al testo originale dopo 3 secondi
        setTimeout(() => {
          reloadButton.innerHTML = originalText;
          reloadButton.disabled = false;
        }, 3000);
      }
    }

    // Event listeners
    participantsInput.addEventListener("input", () => {
      updateParticipantClasses();
      updateDistribution();
    });

    // Inizializzazione
    loadProducts();
    updateParticipantClasses();
   </script>
 </body>
</html>