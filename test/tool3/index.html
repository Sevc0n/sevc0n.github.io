<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calcolatore Cacciatore - Sevcon Tools</title>
  <link rel="icon" type="image/png" href="../../logo.png">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      min-height: 100vh;
      padding: 20px;
      color: #ffffff;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
      background: rgba(26, 26, 46, 0.95);
      backdrop-filter: blur(15px);
      border-radius: 25px;
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.6);
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.15);
    }

    header {
      background: linear-gradient(135deg, #1a1a2e, #16213e);
      color: white;
      padding: 35px;
      text-align: center;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      position: relative;
    }

    h1 {
      font-size: 2.5rem;
      font-weight: 800;
      margin-bottom: 10px;
      background: linear-gradient(45deg, #ff6b6b, #ffd93d);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .subtitle {
      font-size: 1.2rem;
      opacity: 0.9;
      font-weight: 300;
    }

    .version-badge {
      position: absolute;
      top: 20px;
      left: 20px;
      background: rgba(16, 185, 129, 0.2);
      border: 1px solid rgba(16, 185, 129, 0.5);
      border-radius: 8px;
      padding: 6px 12px;
      font-size: 0.75rem;
      color: #10b981;
      font-weight: 600;
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
    }

    main {
      padding: 40px;
    }

    .calculator-section {
      background: rgba(16, 185, 129, 0.1);
      border: 1px solid rgba(16, 185, 129, 0.3);
      border-radius: 20px;
      padding: 35px;
      margin-bottom: 35px;
      box-shadow: 0 8px 25px rgba(16, 185, 129, 0.2);
    }

    .calculator-section h2 {
      color: #10b981;
      margin-bottom: 20px;
      font-size: 1.8rem;
      font-weight: 700;
      text-align: center;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 25px;
      margin: 30px 0;
    }

    .form-group {
      background: rgba(50, 130, 184, 0.1);
      border: 1px solid rgba(50, 130, 184, 0.3);
      border-radius: 15px;
      padding: 25px;
    }

    .form-group h3 {
      color: #3282b8;
      margin-bottom: 15px;
      font-size: 1.3rem;
      font-weight: 600;
    }

    .input-group {
      margin-bottom: 15px;
    }

    .input-group label {
      display: block;
      color: #bbe1fa;
      margin-bottom: 8px;
      font-weight: 500;
    }

    .input-group input, .input-group select {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.1);
      color: #ffffff;
      font-size: 1rem;
      transition: all 0.3s ease;
    }

    .input-group input:focus, .input-group select:focus {
      outline: none;
      border-color: #3282b8;
      background: rgba(255, 255, 255, 0.15);
      box-shadow: 0 0 0 3px rgba(50, 130, 184, 0.2);
    }

    .input-group input::placeholder {
      color: rgba(255, 255, 255, 0.6);
    }

    .calculate-button {
      background: linear-gradient(135deg, #3282b8, #0f4c75);
      border: none;
      color: white;
      padding: 18px 40px;
      border-radius: 12px;
      font-size: 1.2rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      margin: 20px auto;
      display: block;
      box-shadow: 0 6px 20px rgba(50, 130, 184, 0.4);
    }

    .calculate-button:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 30px rgba(50, 130, 184, 0.6);
    }

    .results-section {
      background: rgba(16, 185, 129, 0.1);
      border: 1px solid rgba(16, 185, 129, 0.3);
      border-radius: 20px;
      padding: 30px;
      margin: 30px 0;
      text-align: center;
    }

    .results-section h3 {
      color: #10b981;
      margin-bottom: 20px;
      font-size: 1.5rem;
      font-weight: 700;
    }

    .results-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin: 20px 0;
    }

    .result-card {
      background: rgba(50, 130, 184, 0.1);
      border: 1px solid rgba(50, 130, 184, 0.3);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
    }

    .result-value {
      font-size: 2rem;
      font-weight: 700;
      color: #3282b8;
      margin-bottom: 5px;
    }

    .result-label {
      color: #bbe1fa;
      font-size: 0.9rem;
      font-weight: 500;
    }

    .profit-positive {
      color: #10b981 !important;
    }

    .profit-negative {
      color: #ef4444 !important;
    }


    .back-link {
      display: inline-block;
      padding: 15px 30px;
      background: rgba(50, 130, 184, 0.1);
      border: 1px solid rgba(50, 130, 184, 0.3);
      color: #3282b8;
      text-decoration: none;
      border-radius: 12px;
      transition: all 0.3s ease;
      font-weight: 600;
      margin: 5px;
    }

    .back-link:hover {
      background: rgba(50, 130, 184, 0.2);
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(50, 130, 184, 0.3);
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="version-badge">
        üèπ v1.0.0<br>
        <small>02/10/2025 23:44</small>
      </div>
      <h1>Calcolatore Cacciatore</h1>
      <p class="subtitle">Calcola guadagni e perdite delle tue spedizioni negli abissi</p>
    </header>

    <main>
      <div class="calculator-section">
        <h2>üí∞ Sezione Guadagno</h2>
        <p style="color: #d1d5db; text-align: center; margin-bottom: 30px; font-size: 1.05rem;">
          Inserisci il guadagno del giorno. Se hai fatto la sfida, seleziona la fase raggiunta per calcolare i bronzini (br) ottenuti.
        </p>

        <div class="form-grid">
          <div class="form-group">
            <h3>üíµ Guadagno Giornaliero</h3>
            <div class="input-group">
              <label for="guadagnoGiorno">Guadagno del giorno (senza costi):</label>
              <input type="number" id="guadagnoGiorno" placeholder="Es: 1200" min="0" step="0.01">
            </div>
          </div>

          <div class="form-group">
            <h3>üèÅ Sfida</h3>
            <div class="input-group" style="display: flex; align-items: center; gap: 10px;">
              <input type="checkbox" id="fattaSfida" style="width: 20px; height: 20px;">
              <label for="fattaSfida" style="margin: 0;">Hai fatto la sfida?</label>
            </div>

            <div id="faseContainer" style="display: none; margin-top: 10px;">
              <div class="input-group">
                <label for="faseSfida">Fase raggiunta:</label>
                <select id="faseSfida">
                  <option value="1">Fase 1 (13 br)</option>
                  <option value="2">Fase 2 (13 + 18 = 31 br)</option>
                  <option value="3">Fase 3 (31 + 18 = 49 br)</option>
                  <option value="4">Fase 4 (49 + 23 = 72 br)</option>
                </select>
              </div>
            </div>
          </div>
        </div>

        <button class="calculate-button" onclick="calcolaGuadagno()">üßÆ Calcola Guadagno</button>

        <div class="results-section" id="resultsGuadagno" style="display: none;">
          <h3>üìä Risultati Guadagno</h3>
          <div class="results-grid">
            <div class="result-card">
              <div class="result-value" id="valoreGuadagno">0</div>
              <div class="result-label">Guadagno del Giorno</div>
            </div>
            <div class="result-card">
              <div class="result-value" id="bronziniTotali">0 br</div>
              <div class="result-label">Bronzini dalla Sfida</div>
            </div>
          </div>
          <button class="calculate-button" style="margin-top: 10px;" onclick="salvaGiornataGuadagno()">üíæ Salva giornata</button>
        </div>
      </div>

      <div class="calculator-section">
        <h2>üõ°Ô∏è Sezione Costi</h2>
        <p style="color: #d1d5db; text-align: center; margin-bottom: 30px; font-size: 1.05rem;">
          Inserisci i dati dei consumi e delle riparazioni. I calcoli verranno applicati nel prossimo step.
        </p>

        <div class="form-grid">
          <div class="form-group">
            <h3>üõ°Ô∏è Armatura (durabilit√† pezzi)</h3>
            <div class="input-group">
              <label for="elmoDur">Elmo - durabilit√† finale (0-240):</label>
              <input type="number" id="elmoDur" placeholder="Es: 210" min="0" max="240" step="1">
            </div>
            <div class="input-group">
              <label for="torsoDur">Torso - durabilit√† finale (0-240):</label>
              <input type="number" id="torsoDur" placeholder="Es: 180" min="0" max="240" step="1">
            </div>
            <div class="input-group">
              <label for="gambeDur">Gambe - durabilit√† finale (0-240):</label>
              <input type="number" id="gambeDur" placeholder="Es: 95" min="0" max="240" step="1">
            </div>
            <div class="input-group">
              <label for="stivaliDur">Stivali - durabilit√† finale (0-240):</label>
              <input type="number" id="stivaliDur" placeholder="Es: 240" min="0" max="240" step="1">
            </div>
          </div>

          <div class="form-group">
            <h3>üèπ Frecce</h3>
            <div class="input-group">
              <label for="frecceUsate">Frecce utilizzate:</label>
              <input type="number" id="frecceUsate" placeholder="Es: 120" min="0">
            </div>
            <div class="input-group">
              <label for="costoPerFreccia">Costo per freccia:</label>
              <input type="number" id="costoPerFreccia" placeholder="Es: 2.50" min="0" step="0.01">
            </div>
          </div>

          <div class="form-group">
            <h3>üß™ Pozioni</h3>
            <div class="input-group">
              <label for="pozioniUsate">Pozioni utilizzate:</label>
              <input type="number" id="pozioniUsate" placeholder="Es: 6" min="0">
            </div>
            <div class="input-group">
              <label for="costoPerPozione">Costo per pozione:</label>
              <input type="number" id="costoPerPozione" placeholder="Es: 15.00" min="0" step="0.01">
            </div>
          </div>

          <div class="form-group">
            <h3>üß∞ Materiali Patch Rame</h3>
            <div class="input-group">
              <label for="costoLingotto">Costo 1x Lingotto di Rame (br):</label>
              <input type="number" id="costoLingotto" placeholder="Default 21" min="0" step="0.1" value="21">
            </div>
            <div class="input-group">
              <label for="costoWool">Costo 1x Woolen Fabric (br):</label>
              <input type="number" id="costoWool" placeholder="Default 1.5" min="0" step="0.1" value="1.5">
            </div>
            <div class="input-group">
              <label>Note crafting:</label>
              <div style="color:#a0aec0;">1 lingotto + 1 woolen fabric ‚áí 4 patch (1 patch ripara 60 durabilit√†)</div>
            </div>
          </div>
        </div>

        <button class="calculate-button" onclick="calcolaCostiArmatura()">üßÆ Calcola Costi Armatura</button>

        <div class="results-section" id="risultatiCostiArmatura" style="display:none;">
          <h3>üìâ Risultati Costi Armatura</h3>
          <div class="results-grid">
            <div class="result-card"><div class="result-value" id="patchElmo">0</div><div class="result-label">Patch per Elmo</div></div>
            <div class="result-card"><div class="result-value" id="patchTorso">0</div><div class="result-label">Patch per Torso</div></div>
            <div class="result-card"><div class="result-value" id="patchGambe">0</div><div class="result-label">Patch per Gambe</div></div>
            <div class="result-card"><div class="result-value" id="patchStivali">0</div><div class="result-label">Patch per Stivali</div></div>
            <div class="result-card"><div class="result-value" id="patchTotali">0</div><div class="result-label">Patch Totali</div></div>
            <div class="result-card"><div class="result-value" id="craftNecessari">0</div><div class="result-label">Craft (x4 patch)</div></div>
            <div class="result-card"><div class="result-value" id="costoTotalePatch">0 br</div><div class="result-label">Costo Totale Patch</div></div>
          </div>
        </div>
      </div>

      <div class="calculator-section" id="storicoGuadagno" style="display: none;">
        <h2>üóÇÔ∏è Storico Giorni (Guadagno)</h2>
        <p style="color: #d1d5db; text-align: center; margin-bottom: 20px; font-size: 0.95rem;">I dati vengono salvati solo sul tuo browser.</p>
        <div id="listaStorico" class="feature-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 15px;"></div>
        <div style="text-align: center; margin-top: 15px;">
          <button class="calculate-button" onclick="cancellaStoricoGuadagno()">üóëÔ∏è Cancella storico</button>
        </div>
      </div>

      

      <div style="text-align: center; margin-top: 40px;">
        <a href="../../accesso-test.html" class="back-link">üîô Torna all'Accesso</a>
        <a href="../../index.html" class="back-link">üè† Homepage</a>
        <a href="../tool1/index.html" class="back-link">üîß Tool 1</a>
        <a href="../tool2/index.html" class="back-link">üî¨ Tool 2</a>
      </div>

      <div class="calculator-section" id="riepilogoGenerale" style="margin-top: 25px;">
        <h2>üßæ Riepilogo</h2>
        <div id="riepilogoGiorni" class="results-grid"></div>
        <div id="riepilogoSettimane" class="results-grid" style="margin-top: 20px;"></div>
      </div>
    </main>
  </div>

  <script>
    function placeholderCalcolaCosti() {
      alert('La sezione costi verr√† completata nel prossimo step con i calcoli dettagliati.');
    }

    function patchesNecessariePerPezzo(durFinale) {
      // Ogni pezzo ha max 240; patch ripara 60. Spreco accettabile: ‚â§ 6 durabilit√†
      const max = 240;
      const deficit = Math.max(0, max - (Number(durFinale) || 0));
      if (deficit <= 6) return 0; // Non patchare se il recupero sprecherebbe fino a 6 punti
      return Math.ceil(deficit / 60);
    }

    function calcolaCostiArmatura() {
      const elmo = parseFloat(document.getElementById('elmoDur').value) || 0;
      const torso = parseFloat(document.getElementById('torsoDur').value) || 0;
      const gambe = parseFloat(document.getElementById('gambeDur').value) || 0;
      const stivali = parseFloat(document.getElementById('stivaliDur').value) || 0;

      const costoLingotto = parseFloat(document.getElementById('costoLingotto').value) || 0;
      const costoWool = parseFloat(document.getElementById('costoWool').value) || 0;

      const pElmo = patchesNecessariePerPezzo(elmo);
      const pTorso = patchesNecessariePerPezzo(torso);
      const pGambe = patchesNecessariePerPezzo(gambe);
      const pStivali = patchesNecessariePerPezzo(stivali);
      const pTot = pElmo + pTorso + pGambe + pStivali;

      // 1 craft = 1 lingotto + 1 woolen = 4 patch
      const craft = Math.ceil(pTot / 4);
      const costoTot = craft * (costoLingotto + costoWool);

      document.getElementById('patchElmo').textContent = pElmo;
      document.getElementById('patchTorso').textContent = pTorso;
      document.getElementById('patchGambe').textContent = pGambe;
      document.getElementById('patchStivali').textContent = pStivali;
      document.getElementById('patchTotali').textContent = pTot;
      document.getElementById('craftNecessari').textContent = craft;
      document.getElementById('costoTotalePatch').textContent = `${costoTot.toFixed(1)} br`;

      const res = document.getElementById('risultatiCostiArmatura');
      res.style.display = 'block';
      res.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
    const STORAGE_KEY_GUADAGNO = 'hunter_calc_guadagno_v1';
    const BR_LABEL = ' br';

    function toggleFaseVisibility() {
      const fattaSfida = document.getElementById('fattaSfida').checked;
      const faseContainer = document.getElementById('faseContainer');
      faseContainer.style.display = fattaSfida ? 'block' : 'none';
    }

    function calcolaBronziniPerFase(fase) {
      // cumulativo: F1=13, F2=31, F3=49, F4=72
      switch (Number(fase)) {
        case 1: return 13;
        case 2: return 31;
        case 3: return 49;
        case 4: return 72;
        default: return 0;
      }
    }

    function calcolaGuadagno() {
      const guadagno = parseFloat(document.getElementById('guadagnoGiorno').value) || 0;
      const fattaSfida = document.getElementById('fattaSfida').checked;
      const fase = fattaSfida ? document.getElementById('faseSfida').value : 0;
      const bronzini = fattaSfida ? calcolaBronziniPerFase(fase) : 0;

      document.getElementById('valoreGuadagno').textContent = guadagno.toFixed(2);
      document.getElementById('bronziniTotali').textContent = bronzini + ' br';
      document.getElementById('resultsGuadagno').style.display = 'block';
      document.getElementById('resultsGuadagno').scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    function salvaGiornataGuadagno() {
      const guadagno = parseFloat(document.getElementById('guadagnoGiorno').value) || 0;
      const fattaSfida = document.getElementById('fattaSfida').checked;
      const fase = fattaSfida ? Number(document.getElementById('faseSfida').value) : 0;
      const bronzini = fattaSfida ? calcolaBronziniPerFase(fase) : 0;

      const entry = {
        id: Date.now(),
        date: new Date().toISOString(),
        guadagno,
        fattaSfida,
        fase,
        bronzini
      };

      const existing = JSON.parse(localStorage.getItem(STORAGE_KEY_GUADAGNO) || '[]');
      existing.push(entry);
      localStorage.setItem(STORAGE_KEY_GUADAGNO, JSON.stringify(existing));

      renderStoricoGuadagno();
      const section = document.getElementById('storicoGuadagno');
      section.style.display = 'block';
      section.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    function cancellaStoricoGuadagno() {
      if (!confirm('Sei sicuro di voler cancellare lo storico del guadagno?')) return;
      localStorage.removeItem(STORAGE_KEY_GUADAGNO);
      renderStoricoGuadagno();
    }

    function formatDate(d) {
      try {
        const date = new Date(d);
        return date.toLocaleString();
      } catch (_) { return d; }
    }

    function renderStoricoGuadagno() {
      const container = document.getElementById('listaStorico');
      const wrapper = document.getElementById('storicoGuadagno');
      const riepilogoGiorni = document.getElementById('riepilogoGiorni');
      const riepilogoSettimane = document.getElementById('riepilogoSettimane');
      if (!container || !wrapper) return;

      const entries = JSON.parse(localStorage.getItem(STORAGE_KEY_GUADAGNO) || '[]');
      if (entries.length === 0) {
        wrapper.style.display = 'none';
        container.innerHTML = '';
        if (riepilogoGiorni) riepilogoGiorni.innerHTML = '';
        if (riepilogoSettimane) riepilogoSettimane.innerHTML = '';
        return;
      }

      wrapper.style.display = 'block';
      container.innerHTML = entries
        .sort((a, b) => b.id - a.id)
        .map(e => {
          const labelFase = e.fattaSfida && e.fase ? `Fase ${e.fase}` : 'Nessuna sfida';
          return `
            <div class="feature-card" style="background: rgba(45,55,72,0.5); border:1px solid rgba(255,255,255,0.08);">
              <h3>üóìÔ∏è ${formatDate(e.date)}</h3>
              <ul>
                <li>Guadagno: <strong>‚Ç¨${e.guadagno.toFixed(2)}</strong></li>
                <li>Sfida: <strong>${labelFase}</strong></li>
                <li>Bronzini: <strong>${e.bronzini} br</strong></li>
              </ul>
              <div style="margin-top:10px; display:flex; gap:10px;">
                <button class="back-link" onclick="eliminaEntryGuadagno(${e.id})">Elimina</button>
              </div>
            </div>
          `;
        }).join('');

      // Riepilogo giornaliero (per ora costi=0 perch√© la sezione costi arriver√† dopo)
      if (riepilogoGiorni) {
        riepilogoGiorni.innerHTML = entries
          .sort((a, b) => b.id - a.id)
          .map(e => {
            const guadagnoBr = e.bronzini; // bronzini dalla sfida
            const costiBr = 0;            // placeholder fino alla sezione costi
            const totale = guadagnoBr - costiBr;
            const sign = totale >= 0 ? '+' : '-';
            return `
              <div class="result-card">
                <div class="result-value">${formatDate(e.date)}</div>
                <div class="result-label">guadagno: <strong>${guadagnoBr}${BR_LABEL}</strong>, costi: <strong>${costiBr} bronzini</strong>, totale ${sign} <strong>${Math.abs(totale)}${BR_LABEL}</strong></div>
              </div>
            `;
          }).join('');
      }

      // Aggregazione settimanale (ISO week)
      if (riepilogoSettimane) {
        const byWeek = {};
        entries.forEach(e => {
          const d = new Date(e.date);
          const year = d.getFullYear();
          const week = getISOWeekNumber(d);
          const key = `${year}-W${week}`;
          if (!byWeek[key]) byWeek[key] = { dates: [], guadagnoBr: 0, costiBr: 0 };
          byWeek[key].dates.push(d);
          byWeek[key].guadagnoBr += e.bronzini;
          // costiBr rester√† 0 finch√© non implementiamo la sezione costi
        });

        const cards = Object.entries(byWeek).sort(([a], [b]) => a < b ? 1 : -1).map(([key, val]) => {
          const minDate = new Date(Math.min.apply(null, val.dates));
          const maxDate = new Date(Math.max.apply(null, val.dates));
          const range = `${minDate.toLocaleDateString()} ‚Üí ${maxDate.toLocaleDateString()}`;
          const totale = val.guadagnoBr - val.costiBr;
          const sign = totale >= 0 ? '+' : '-';
          return `
            <div class="result-card">
              <div class="result-value">Settimana ${key}</div>
              <div class="result-label">${range}</div>
              <div class="result-label">guadagno: <strong>${val.guadagnoBr}${BR_LABEL}</strong>, costi: <strong>${val.costiBr} bronzini</strong>, totale ${sign} <strong>${Math.abs(totale)}${BR_LABEL}</strong></div>
            </div>
          `;
        }).join('');

        riepilogoSettimane.innerHTML = cards;
      }
    }

    function eliminaEntryGuadagno(id) {
      const entries = JSON.parse(localStorage.getItem(STORAGE_KEY_GUADAGNO) || '[]');
      const filtered = entries.filter(e => e.id !== id);
      localStorage.setItem(STORAGE_KEY_GUADAGNO, JSON.stringify(filtered));
      renderStoricoGuadagno();
    }

    // placeholder: la sezione spedizione verr√† reintrodotta in seguito

    // Validazione input in tempo reale
    document.addEventListener('DOMContentLoaded', function() {
      const inputs = document.querySelectorAll('input[type="number"]');
      inputs.forEach(input => {
        input.addEventListener('input', function() {
          if (this.value < 0) {
            this.value = 0;
          }
        });
      });
      // Attiva toggle fase alla prima apertura
      const fattaSfida = document.getElementById('fattaSfida');
      if (fattaSfida) {
        fattaSfida.addEventListener('change', toggleFaseVisibility);
        toggleFaseVisibility();
      }
      // Render iniziale storico
      renderStoricoGuadagno();
    });

    // Animazione di benvenuto
    window.addEventListener('load', () => {
      const cards = document.querySelectorAll('.form-group');
      cards.forEach((card, index) => {
        setTimeout(() => {
          card.style.opacity = '0';
          card.style.transform = 'translateY(20px)';
          card.style.transition = 'all 0.6s ease';
          
          setTimeout(() => {
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
          }, 100);
        }, index * 200);
      });
    });

    function getISOWeekNumber(date) {
      const tmp = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
      const dayNum = tmp.getUTCDay() || 7;
      tmp.setUTCDate(tmp.getUTCDate() + 4 - dayNum);
      const yearStart = new Date(Date.UTC(tmp.getUTCFullYear(),0,1));
      const weekNo = Math.ceil((((tmp - yearStart) / 86400000) + 1)/7);
      return weekNo;
    }
  </script>
</body>
</html>
